<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <style>
      #body {
        font-family: arial;
        margin: 0;
        padding: none;
      }

     #header{
         width: 100%;
         height: 100px;
         margin: 0 auto;
         text-align: center;
         margin-top: 10px;
    }

     .container {
         display: flex;
         flex-direction: column; /* Stack items vertically */
         justify-content: center; /* Center horizontally */
         align-items: center; /* Center vertically */
         height: 10vh; /* Full viewport height */
     }

        .input-group {
            display: flex;
            flex-direction: row;
            gap: 10px; /* Space between inputs */
        }

        .label-and-button {
            display: flex;
            flex-direction: column;
            gap: 10px; /* Space between inputs */
        }

        input, button {
            padding: 10px;
            font-size: 16px;
        }

        button {
            margin-top: 10px; /* Space between inputs and button */
        }

        .filter-group {
            display: flex;
            flex-direction: row;
            padding: none;
        }

    #about{
         text-align: center;
     }

   #races{
       margin: 0 auto;
       text-align: center;
    }

input, select {
    height: 40px;
    padding: 8px;
    font-size: 16px;
    border: 1px solid #ccc;
    box-sizing: border-box;
    vertical-align: middle;
}

    #regsize{
         position: relative;
     }

     #generator{
         position: relative;
         float: center;
    }

     #myInput1{
         position: relative;
         top: 100px;
         margin: 20px auto;
         float: center;
         height: 25px;
     }

    #myInput2{
        position: relative;
        top: 100px;
        margin: 20px auto;
        float: center;
        height: 25px;
    }

    #myInput3{
        position: relative;
        top: 100px;
        margin: 20px auto;
        float: center;
        height: 25px;
    }
    #myInput4{
        position: relative;
        top: 100px;
        margin: 20px auto;
        float: center;
        height: 25px;
    }

     #userTable{
         width: 100%;
         margin: 0 auto;
         margin-top: 100px;
         border-left: 0px;
         border-right: 0px;
         padding-left: 0px;
         padding-right: 0px;
         font-family: 'Lucida Console', Monaco, monospace;
         outline: none;
     }
    </style>
  </head>


    <!--  textarea id="output" rows="8"></textarea> -->

<h2 id="header" > DiskBuilder </h2>
<div class="container">
    <p id="about">
        <br>
        <br>
        Press button to generate your army.
        <br>
        <br>
        then go flip some disks FTW
        <br>
        <br>
    </p>
<div class="input-group">

    <div class="label-and-button"
    <label for="races">Race:</label>
    <select name="races" id="races">
    <option value="empire">Empire</option>
    <option value="elves">Elves</option>
    <option value="dwarves">Dwarves</option>
    <option value="woodelves">Wood Elves</option>
    <option value="chaos">Chaos</option>
    <option value="orcs">Orcs</option>
    <option value="vc">Vampire Counts</option>
    <option value="skaven">Skaven</option>
    </select>
    </div>
    <!--  input type="number" id="race" placeholder="Enter your race"><br><br>
-->
    <div class="label-and-button"
    <label for="regsize">Regiment Size:</label>
    <input type="number" id="regsize" placeholder="Enter regiment size"><br><br>
    </div>
</div>
    <button onclick="GenerateArmy()" id="generator">Generate Army</button>
</div>

<div class="filter-group">
    <input type="text" id="myInput1" onkeyup="search()" placeholder="Filter 1 ">
    <input type="text" id="myInput2" onkeyup="search()" placeholder="Filter 2">
    <input type="text" id="myInput3" onkeyup="search()" placeholder="Filter 3">
    <input type="text" id="myInput4" onkeyup="search()" placeholder="Filter 4">
</div>

<table id="userTable" border="1">
    <thead>
      <tr>
      </tr>
    </thead>
    <tbody>
      <!-- Data will be inserted here -->
    </tbody>
  </table>

    <script type='text/javascript'>

function search() {
    // Declare variables
    var input1, input2, input3, filter, table, tr, td, i, txtValue, rowText;
    input1 = document.getElementById("myInput1");
    input2 = document.getElementById("myInput2");
    input3 = document.getElementById("myInput3");
    input4 = document.getElementById("myInput4");
    filter1 = input1.value.toUpperCase();
    filter2 = input2.value.toUpperCase();
    filter3 = input3.value.toUpperCase();
    filter4 = input4.value.toUpperCase();

    table = document.getElementById("userTable");
    tr = table.querySelectorAll("tbody tr");

    // Loop through all table rows, and hide those who don't match the search query
    for (i = 0; i < tr.length; i++) {
        td = tr[i].getElementsByTagName("td");
        rowText = ''; // Initialize an empty string to hold text for this row

        // Loop through each cell in the row
        for (var j = 0; j < td.length; j++) {
            if (td[j]) {
                rowText += td[j].textContent || td[j].innerText; // Append text of each cell to rowText
            }
        }

         // If any cell in the row contains the search query, display the row, otherwise hide it
         if (rowText.toUpperCase().indexOf(filter1) > -1 && rowText.toUpperCase().indexOf(filter2) > -1 && rowText.toUpperCase().indexOf(filter3) > -1 && rowText.toUpperCase().indexOf(filter4) > -1) {
             tr[i].style.display = "";
        } else {
            tr[i].style.display = "none";
        }
    }
}

function GenerateArmy(){
        //clearOutput();
        let Race = document.getElementById("races").value;
        let Size = document.getElementById("regsize").value;
        console.log(Race);
        console.log(Size);
        stringPointer = _PrintToJson(34,1);
        stringPointerLast = stringPointer;

        // Get the length of the string (you might need to know this, or you can calculate it)
        let stringLength = 0;  // For example, the length of "Hello from C++!"
             while(HEAPU8[stringPointer + stringLength] !== 0){
                 stringLength++;
         }

        // Read the string from WebAssembly memory
        const str = UTF8ToString(stringPointer, stringLength);
        //_PrintToBrowser(5,2)
        JSON.stringify(str);
        stringPointer = stringPointerLast;
        var obj = JSON.parse(str);
        createTableFromJSON(obj);
}

function createTableFromJSON(jsonData) {
      const table = document.querySelector("#userTable");
      const tableHead = table.querySelector("thead");
      const tableBody = table.querySelector("tbody");

      // Clear existing table content
      tableHead.innerHTML = "";
      tableBody.innerHTML = "";

      // Create headers (table columns) based on the keys of the first object in the JSON
      const headers = Object.keys(jsonData[0]);
      const headerRow = document.createElement("tr");

      // Loop through the keys and create table headers
      headers.forEach(header => {
        const th = document.createElement("th");
        th.textContent = header.replace(/_/g, " ").toUpperCase();  // Optional: format header text
        headerRow.appendChild(th);
      });

      // Append headers to the table
      tableHead.appendChild(headerRow);

      // Create rows for each object in the JSON data
      jsonData.forEach(item => {
        const row = document.createElement("tr");

        // Loop through each header and create a cell for each key
        headers.forEach(header => {
          const cell = document.createElement("td");
          // Insert value or an empty string if key is missing in this object
          cell.textContent = item[header] || '';
          row.appendChild(cell);
        });

        // Append the row to the table body
        tableBody.appendChild(row);
      });
}




      var Module = {
        preRun: [],
        postRun: [],
        print: (function() {
          var element = document.getElementById('output');
          if (element) element.value = ''; // clear browser cache
          return function(text) {
            if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
            // These replacements are necessary if you render to raw HTML
            //text = text.replace(/&/g, "&amp;");
            //text = text.replace(/</g, "&lt;");
            //text = text.replace(/>/g, "&gt;");
            //text = text.replace('\n', '<br>', 'g');
            console.log(text);
            if (element) {
              element.value += text + "\n";
              element.scrollTop = element.scrollHeight; // focus on bottom
            }
          };
        })(),
        setStatus: function(text) {
          if (!Module.setStatus.last) Module.setStatus.last = { time: Date.now(), text: '' };
          if (text === Module.setStatus.last.text) return;
          var m = text.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/);
          var now = Date.now();
          if (m && now - Module.setStatus.last.time < 30) return; // if this is a progress update, skip it if too soon
          Module.setStatus.last.time = now;
          Module.setStatus.last.text = text;
        },
        totalDependencies: 0,
        monitorRunDependencies: function(left) {
          this.totalDependencies = Math.max(this.totalDependencies, left);
          Module.setStatus(left ? 'Preparing... (' + (this.totalDependencies-left) + '/' + this.totalDependencies + ')' : 'All downloads complete.');
        }
      };
      Module.setStatus('Downloading...');
      window.onerror = function(event) {
        // TODO: do not warn on ok events like simulating an infinite loop or exitStatus
        Module.setStatus('Exception thrown, see JavaScript console');
        spinnerElement.style.display = 'none';
        Module.setStatus = function(text) {
          if (text) Module.printErr('[post-exception status] ' + text);
        };
      };
    </script>
    <script async type="text/javascript" src="index.js"></script>
  </body>
</html>
